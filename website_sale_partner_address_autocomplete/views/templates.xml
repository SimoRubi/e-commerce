<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2018 Simone Rubino - Agile Business Group
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->

<odoo>
    <template id="assets_frontend" inherit_id="website.assets_frontend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/website_sale_partner_address_autocomplete/static/src/js/website_sale_partner_address_autocomplete.js"/>
        </xpath>
    </template>

    <template id="address" inherit_id="website_sale.address">
        <xpath expr="//form[@name='/shop/checkout']//select[@name='state_id']/ancestor::div[1]" position="after">
            <div class="clearfix"/>
            <div class="form-group col-md-6">
                <label class="radio-inline">
                    <input type="radio" name="company_type" value="person" class="js_company_type_change"
                           t-att-checked="'company_type' in checkout and checkout['company_type'] == 'person'"/>
                    Person
                </label>
                <label class="radio-inline">
                    <input type="radio" name="company_type" value="company" class="js_company_type_change"
                           t-att-checked="'company_type' in checkout and checkout['company_type'] == 'company'"/>
                    Company
                </label>
            </div>
            <div class="clearfix"/>
            <div name="additional_data" class="form-group col-md-12">
                <!-- Hide this block when this is not a person, using class so that js can change it back -->
                <div name="person_data" t-att-class="'company_type' in checkout and checkout['company_type'] != 'person' and 'hidden'">
                    <div t-attf-class="form-group col-md-4" id="div_birth_city">
                        <label class="control-label label-optional" for="birth_city">Birth city</label>
                        <input name="birth_city" class="form-control" t-att-value="'birth_city' in checkout and checkout['birth_city']" />
                    </div>
                    <div t-attf-class="form-group col-md-4 div_birth_country">
                        <label class="control-label label-optional" for="birth_country_id">Birth country</label>
                        <select id="birth_country_id" name="birth_country_id" class="form-control js_birth_country_change">
                            <option value="">Birth country...</option>
                            <t t-foreach="request.env['res.country'].search([])" t-as="c">
                                <option t-att-value="c.id"
                                        t-att-selected="c.id == ('birth_country_id' in checkout and checkout['birth_country_id'] != '' and int(checkout['birth_country_id']) or -1)">
                                    <t t-esc="c.name" />
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-md-4 div_birth_state"
                         t-att-style="'birth_country_id' in checkout and not checkout['birth_country_id'] and 'display: none'">
                        <label class="control-label label-optional" for="birth_state_id">Birth state / province</label>
                        <select name="birth_state_id" class="form-control" data-init="1">
                            <t t-foreach="request.env['res.country.state'].search([('country_id', '=', 'birth_country_id' in checkout and checkout['birth_country_id'] != '' and int(checkout['birth_country_id']) or -1)])" t-as="s">
                                <option t-att-value="s.id"
                                        t-att-selected="s.id == ('birth_state_id' in checkout and checkout['birth_state_id'] != '' and int(checkout['birth_state_id']) or 0)">
                                    <t t-esc="s.name" />
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-md-6 div_birthdate_date">
                        <label class="control-label label-optional" for="birthdate_date">Birth date</label>
                        <input name="birthdate_date" type="text" class="form-control"
                               t-att-value="'birthdate_date' in checkout and checkout['birthdate_date']"/>
                        <!-- Not working: ... and datetime.datetime.strptime(checkout['birthdate_date'], '%Y-%m-%d').strftime('%d/%m/%Y') -->
                    </div>
                </div>
                <!-- Hide this block when this is not a company, using class so that js can change it back -->
                <div name="company_data" t-att-class="'company_type' in checkout and checkout['company_type'] != 'company' and 'hidden'">
                    <div t-attf-class="form-group #{error.get('vat') and 'has-error' or ''} col-md-6 div_vat">
                        <label class="control-label" for="vat">TIN / VAT </label>
                        <input type="text" name="vat" placeholder="IT12345678901" class="form-control"
                               t-att-value="'vat' in checkout and checkout['vat']" />
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//form[@name='/shop/checkout']//input[@name='use_invoice']" position="attributes">
            <attribute name="class">js_use_invoice_change</attribute>
        </xpath>
    </template>
</odoo>
